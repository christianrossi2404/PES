%================= SHAPE FUNCTIONS ==================================
%
%        Calculates shape functions for various element types
%
function N = shapefunctions(nelnodes,ncoord,elident,xi,n)

 N = zeros(n,nelnodes);
%
xi = xi';
% (ncoord==3) 

if (nelnodes == 4) 
    for i1=1:n
       N(i1,1) = xi(i1,1);
       N(i1,2) = xi(i1,2);
       N(i1,3) = xi(i1,3);
       N(i1,4) = 1.-xi(i1,1)-xi(i1,2)-xi(i1,3);
    end
elseif (nelnodes == 10) 
    for i1=1:n
       xi4 = 1.-xi(i1,1)-xi(i1,2)-xi(i1,3);
       N(i1,1) = (2.*xi(i1,1)-1.)*xi(i1,1);
       N(i1,2) = (2.*xi(i1,2)-1.)*xi(i1,2);
       N(i1,3) = (2.*xi(i1,3)-1.)*xi(i1,3);
       N(i1,4) = (2.*xi4-1.)*xi4;
       N(i1,5) = 4.*xi(i1,1)*xi(i1,2);
       N(i1,6) = 4.*xi(i1,2)*xi(i1,3);
       N(i1,7) = 4.*xi(i1,3)*xi(i1,1);
       N(i1,8) = 4.*xi(i1,1)*xi4;
       N(i1,9) = 4.*xi(i1,2)*xi4;
       N(i1,10) = 4.*xi(i1,3)*xi4;
    end
elseif (nelnodes == 8) 
    for i1=1:n
       N(i1,1) = (1.-xi(i1,1))*(1.-xi(i1,2))*(1.-xi(i1,3))/8.;
       N(i1,2) = (1.+xi(i1,1))*(1.-xi(i1,2))*(1.-xi(i1,3))/8.;
       N(i1,3) = (1.+xi(i1,1))*(1.+xi(i1,2))*(1.-xi(i1,3))/8.;
       N(i1,4) = (1.-xi(i1,1))*(1.+xi(i1,2))*(1.-xi(i1,3))/8.;
       N(i1,5) = (1.-xi(i1,1))*(1.-xi(i1,2))*(1.+xi(i1,3))/8.;
       N(i1,6) = (1.+xi(i1,1))*(1.-xi(i1,2))*(1.+xi(i1,3))/8.;
       N(i1,7) = (1.+xi(i1,1))*(1.+xi(i1,2))*(1.+xi(i1,3))/8.;
       N(i1,8) = (1.-xi(i1,1))*(1.+xi(i1,2))*(1.+xi(i1,3))/8.;   
    end
elseif (nelnodes == 20) 
    for i1=1:n
       N(i1,1) = (1.-xi(i1,1))*(1.-xi(i1,2))*(1.-xi(i1,3))*(-xi(i1,1)-xi(i1,2)-xi(i1,3)-2.)/8.;
       N(i1,2) = (1.+xi(i1,1))*(1.-xi(i1,2))*(1.-xi(i1,3))*(xi(i1,1)-xi(i1,2)-xi(i1,3)-2.)/8.;
       N(i1,3) = (1.+xi(i1,1))*(1.+xi(i1,2))*(1.-xi(i1,3))*(xi(i1,1)+xi(i1,2)-xi(i1,3)-2.)/8.;
       N(i1,4) = (1.-xi(i1,1))*(1.+xi(i1,2))*(1.-xi(i1,3))*(-xi(i1,1)+xi(i1,2)-xi(i1,3)-2.)/8.;
       N(i1,5) = (1.-xi(i1,1))*(1.-xi(i1,2))*(1.+xi(i1,3))*(-xi(i1,1)-xi(i1,2)+xi(i1,3)-2.)/8.;
       N(i1,6) = (1.+xi(i1,1))*(1.-xi(i1,2))*(1.+xi(i1,3))*(xi(i1,1)-xi(i1,2)+xi(i1,3)-2.)/8.;
       N(i1,7) = (1.+xi(i1,1))*(1.+xi(i1,2))*(1.+xi(i1,3))*(xi(i1,1)+xi(i1,2)+xi(i1,3)-2.)/8.;
       N(i1,8) = (1.-xi(i1,1))*(1.+xi(i1,2))*(1.+xi(i1,3))*(-xi(i1,1)+xi(i1,2)+xi(i1,3)-2.)/8.;
       N(i1,9)  = (1.-xi(i1,1)^2)*(1.-xi(i1,2))*(1.-xi(i1,3))/4.;
       N(i1,10) = (1.+xi(i1,1))*(1.-xi(i1,2)^2)*(1.-xi(i1,3))/4.;
       N(i1,11) = (1.-xi(i1,1)^2)*(1.+xi(i1,2))*(1.-xi(i1,3))/4.;
       N(i1,12) = (1.-xi(i1,1))*(1.-xi(i1,2)^2)*(1.-xi(i1,3))/4.;
       N(i1,13) = (1.-xi(i1,1)^2)*(1.-xi(i1,2))*(1.+xi(i1,3))/4.;
       N(i1,14) = (1.+xi(i1,1))*(1.-xi(i1,2)^2)*(1.+xi(i1,3))/4.;
       N(i1,15) = (1.-xi(i1,1)^2)*(1.+xi(i1,2))*(1.+xi(i1,3))/4.;
       N(i1,16) = (1.-xi(i1,1))*(1.-xi(i1,2)^2)*(1.+xi(i1,3))/4.;
       N(i1,17) = (1.-xi(i1,1))*(1.-xi(i1,2))*(1.-xi(i1,3)^2)/4.;
       N(i1,18) = (1.+xi(i1,1))*(1.-xi(i1,2))*(1.-xi(i1,3)^2)/4.;
       N(i1,19) = (1.+xi(i1,1))*(1.+xi(i1,2))*(1.-xi(i1,3)^2)/4.;
       N(i1,20) = (1.-xi(i1,1))*(1.+xi(i1,2))*(1.-xi(i1,3)^2)/4.;  
    end
end

